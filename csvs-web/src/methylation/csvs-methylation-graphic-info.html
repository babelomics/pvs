<dom-module id="csvs-methylation-graphic-info">
    <style is="custom-style" include="iron-flex iron-flex-reverse iron-flex-alignment iron-flex-factors iron-positioning">
        :host {
            display: block;
            position: relative;
        }
        .prsLabel{
            font-size: 13px;
        }
       }
    </style>
    <template>
        <div>
            <div style="padding-top: 10px;padding-bottom: 10px;">
                <label class="prsLabel"><b>{{diseasesText}}</b></label>
            </div>
            <div>
                <label class="stv" id="min">Min:</label>
                <label class="prsLabel">{{getMin(dataGraphic)}}</label>
            </div>
            <div>
                <label class="stv" id="max">Max:</label>
                <label class="prsLabel">{{getMax(dataGraphic)}}</label>
            </div>
            <div>
                <label class="stv" id="avg"> Average:</label>
                <label class="prsLabel">{{getAvg(dataGraphic)}}</label>
            </div>
            <div>
                <label class="stv" id="stdDev">Std.dev.:</label>
                <label class="prsLabel">{{getStdDev(dataGraphic)}}</label>
            </div>
            <div>
                <label class="stv" id="mean">Mean:</label>
                <label class="prsLabel">{{getMean(dataGraphic)}}</label>
            </div>
            <div>
                <label class="stv" id="quartiles">Quartiles:</label>
                    <template is="dom-repeat" items="[1,2,3]" as="itemValue">
                        <br/>
                        <label class="stv" style="padding-left: 30px"> quartile {{itemValue}}: </label>
                        <label class="prsLabel">{{getQuartile(dataGraphic, itemValue)}}</label>
                    </template>
            </div>
        </div>
    </template>
</dom-module>

<script>
    Polymer({
        is: 'csvs-methylation-graphic-info',
        properties: {
            dataGraphic: {
                value: [],
                type: Array,
            },
            diseasesText:{
                value: "",
                type: String
            }
        },

        formatFixed: function (num, f){
            return ((Math.round(num * Math.pow(10, f))) / (Math.pow(10, f)).toFixed(f))*1;
        },

        formatExpo: function(x, f) {
            if(x != 0){
                return Math.abs(Number.parseFloat(x)) < 0.01 ?
                    Number.parseFloat(x).toExponential(f) :
                    this.formatFixed(Number.parseFloat(x), f);
            } else {
                return 0;
            }
        },
        getAvg: function(data) {
            if (data != null && data.length > 0){
                let sum = 0;
                data.forEach(d => sum += d);
                return averageData = this.formatExpo(sum / data.length, 3);
            } else {
                return "-";
            }
        },
        getMin: function(data) {
            if (data != null && data.length > 0){
                return  this.formatExpo(Math.min(...data), 3);
            } else {
                return "-";
            }
        },

        getMax: function(data) {
            if (data != null && data.length > 0){
                return this.formatExpo(Math.max(...data), 3);
            } else {
                return "-";
            }
        },

        getStdDev: function(data) {
            if (data != null && data.length > 0){
                const mean = this.getMean(data);
                return this.formatExpo(Math.sqrt(data.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / data.length), 3);
            } else {
                return "-";
            }
        },

        getMean: function(data) {
            if (data != null && data.length > 0){
                return this.formatExpo(data.reduce((a, b) => a + b) / data.length, 3);
            } else {
                return "-";
            }
        },

        getQuartile: function(data, num){
            if (data != null && data.length > 0) {
                const dataSort = data.sort();
                const pos = (num * (data.length+1)) / 4;
                const truncPos = Math.trunc(pos);
                if (truncPos+1 < data.length) {
                    return this.formatExpo(dataSort[truncPos] + (pos - truncPos) * ( dataSort[truncPos+1] - dataSort[truncPos] ), 3);
                } else {
                    return "-";
                }
            } else {
                return "-";
            }
        },

        ready: function() {
        },

    });
</script>
